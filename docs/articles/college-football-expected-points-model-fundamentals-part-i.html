<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>College Football Expected Points Model Fundamentals - Part I • cfbscrapR</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/cosmo/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><link href="../extra.css" rel="stylesheet">
<meta property="og:title" content="College Football Expected Points Model Fundamentals - Part I">
<meta property="og:description" content="cfbscrapR">
<meta property="og:image" content="https://raw.githubusercontent.com/saiemgilani/cfbscrapR/master/man/figures/cfbscrapR.ico">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:creator" content="@cfbscrapR">
<meta name="twitter:site" content="@cfbscrapR">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">cfbscrapR</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">1.0.5</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa-home"></span>
     
  </a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    <span class="fas fa-question-circle-o"></span>
     
    Tutorials
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/index.html">Vignettes</a>
    </li>
    <li class="dropdown-header">Introductory</li>
    <li>
      <a href="../articles/intro.html">CFB Analytics with cfbscrapR</a>
    </li>
    <li>
      <a href="../articles/animated-wp-plotting.html">Animated Win Probability Plots</a>
    </li>
    <li>
      <a href="../articles/fourth-down-plot-tutorial.html">Fourth Down Tendency Plots</a>
    </li>
    <li>
      <a href="../articles/rolling-epa-graph.html">Rolling EPA Graphs</a>
    </li>
    <li>
      <a href="../articles/nth-rated-recruit.html">Visualizing Team Talent with Player Recruit Rankings</a>
    </li>
    <li class="dropdown-header">Expected Points Model Fundamentals</li>
    <li>
      <a href="../articles/college-football-expected-points-model-fundamentals-part-i.html">Part 1 - Model Definition</a>
    </li>
    <li>
      <a href="../articles/college-football-expected-points-model-fundamentals-part-ii.html">Part 2 - Regression Models</a>
    </li>
    <li>
      <a href="../articles/college-football-expected-points-model-fundamentals-part-iii.html">Part 3 - History of Expected Points Models</a>
    </li>
  </ul>
</li>
<li>
  <a href="../reference/index.html">
    <span class="fas fa-file-code-o"></span>
     
    Functions
  </a>
</li>
<li>
  <a href="../news/index.html">
    <span class="fas fa-newspaper-o"></span>
     
    News
  </a>
</li>
<li>
  <a href="https://github.com/saiemgilani/cfbscrapR-data">
    <span class="fas fa-database"></span>
     
    Data
  </a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://twitter.com/cfbscrapR">
    <span class="fab fa-twitter fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="https://github.com/saiemgilani/cfbscrapR/">
    <span class="fas fa-github fa-lg"></span>
     
    GitHub
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="college-football-expected-points-model-fundamentals-part-i_files/header-attrs-2.6/header-attrs.js"></script><script src="college-football-expected-points-model-fundamentals-part-i_files/accessible-code-block-0.0.1/empty-anchor.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>College Football Expected Points Model Fundamentals - Part I</h1>
                        <h4 class="author">Saiem Gilani</h4>
            
      
      
      <div class="hidden name"><code>college-football-expected-points-model-fundamentals-part-i.Rmd</code></div>

    </div>

    
    
<p>In this tutorial, we are going to get more familiar with the Expected Points portion of College Football Expected Points Added model.</p>
<p>We will be using these ideas as a tool for valuation of plays with the goal of contextualizing team and player performance relative to the average, given the situational factors at the start of the play.</p>
<p>Let’s dig in.</p>
<div id="the-data" class="section level1">
<h1 class="hasAnchor">
<a href="#the-data" class="anchor"></a>The Data</h1>
<p>We will be acquiring data from <a href="collegefootballdata.com">CollegeFootballData.com</a>, courtesy of @<a href="https://twitter.com/CFB_data">CFB_data</a>, using <code>cfbscrapR</code>, created by <a href="https://twitter.com/saiemgilani">Saiem Gilani</a>, <a href="https://twitter.com/msubbaiah1">Meyappan Subbaiah</a>, and <a href="https://twitter.com/statsowar">Parker Fleming</a>.</p>
</div>
<div id="the-expected-points-model" class="section level1">
<h1 class="hasAnchor">
<a href="#the-expected-points-model" class="anchor"></a>The Expected Points Model</h1>
<div id="outcome-target-variables" class="section level2">
<h2 class="hasAnchor">
<a href="#outcome-target-variables" class="anchor"></a>Outcome (target) variables</h2>
<p>This model generates probabilities for the possible types of next scoring events within the same half. The 7 scoring possibilities are:</p>
<ul>
<li>Touchdown (7)</li>
<li>Field Goal (3)</li>
<li>Safety (2)</li>
<li>No Score (0)</li>
<li>Opponent Safety (-2)</li>
<li>Opponent Field Goal (-3)</li>
<li>Opponent Touchdown (-7)</li>
</ul>
<p>For each play, the multinomial logistic regression model calculates what the probability () of each of those scoring outcomes is and the expected points can be calculated by multiplying each of the scoring event probabilities by their associated point values and summing the products, like so:</p>
<p><a href="https://imgur.com/sJTs6j6"><img src="https://i.imgur.com/sJTs6j6.png" title="Figure: @SaiemGilani"></a></p>
</div>
<div id="predictive-variables" class="section level2">
<h2 class="hasAnchor">
<a href="#predictive-variables" class="anchor"></a>Predictive variables</h2>
<p>The model is fit using the following variables and interactions:</p>
<div id="pure-distance-factors-24-variables" class="section level3">
<h3 class="hasAnchor">
<a href="#pure-distance-factors-24-variables" class="anchor"></a>Pure Distance Factors (24 variables)</h3>
<ul>
<li>Yards from opponent’s end zone (6)</li>
<li>log(yards to convert 1st/Goal) (6)</li>
<li>Indicator for goal-to-go situations (6)</li>
<li>Interaction between log(yards to convert 1st/Goal) and goal-to-go indicator (6)</li>
</ul>
</div>
<div id="down-factors-and-down-interactions-54-variables" class="section level3">
<h3 class="hasAnchor">
<a href="#down-factors-and-down-interactions-54-variables" class="anchor"></a>Down Factors and Down Interactions (54 variables)</h3>
<ul>
<li>Down (18 since Down is a categorical factor)</li>
<li>Interaction between log(yards to convert 1st/Goal) and down (18)</li>
<li>Interaction between yards from opponent’s end zone and down (18)</li>
</ul>
</div>
<div id="time-factors-and-intercept-18-variables" class="section level3">
<h3 class="hasAnchor">
<a href="#time-factors-and-intercept-18-variables" class="anchor"></a>Time Factors and Intercept (18 variables)</h3>
<ul>
<li>Seconds remaining in the current half (6)</li>
<li>Indicator for under two-minutes to the end of half/game (6)</li>
<li>Intercept for each next score type, used as the combined mean value for reference variables, in this case 1st Down, not a goal-to-go situation and outside of under two minutes left to the end of half or game. (6)</li>
</ul>
<p>You might be asking at this point, “how are there 96 variables, if there are only 10 bullet points here?” (skip to the next section if you didn’t ask.) The answer is a little technical if answered completely, but to model this appropriately, one next score type is used as the reference target (we chose “No Score” as our reference) and the coefficients are fitted to the predictive variables for each of the remaining 6 target score types. This is why you see each factor comprising at least 6 variables.</p>
<p>The additional complexity is that down must be treated as a categorical factor, meaning 1st down is treated as the reference and there are then 6 variables for 2nd down, 6 variables for 3rd down, and 6 variables for 4th down. The same logic would then also apply to each of the down interactions. The Boolean indicators for goal-to-go and under two-minutes are also factors that give relative coefficients to the ‘False’ case, but since there only two cases, only 6 additional variables are created for each.</p>
</div>
</div>
<div id="model-weights" class="section level2">
<h2 class="hasAnchor">
<a href="#model-weights" class="anchor"></a>Model Weights</h2>
<p>Observations are weighted by both score differential and difference in number of drives between play and the next score. The former weighting is intended to accomplish the goal of valuing plays where the score differential is higher less than possessions where the score differential is closer to zero.</p>
<p>Additionally, the latter model weighting places more emphasis on plays on drives that occur closer to the next scoring drive more than plays on prior drives. An example would be if a game begins with 6 scoreless drives to start before one team scores, the plays of the first drive would have a weight of 1/7*, the plays of the second drive a 2/7 weighting, with the plays of the first scoring drive (i.e. the 7th possession) having a full 7/7 weighting.</p>
<p>*Full disclosure: it would be 7 as the denominator if 6 scoreless drives was the largest distance between scoring drives for the entire season across all games (it could be 12 for the games across the entire season, in which case the values would have been 1/12, 2/12, …, 7/12.)</p>
<p>This way the model weighs all games with the same denominator and scales the weight of each scoring drive distance to a value between 0 and 1. This same caveat also applies for score differential. Score difference is scaled by largest score differential across all games in a given season. Both of the score differential and scoring drive distance weightings are combined to create a single scaled weighting for each play across each season.</p>
<div id="kicking-kickoffs-and-punts" class="section level3">
<h3 class="hasAnchor">
<a href="#kicking-kickoffs-and-punts" class="anchor"></a>Kicking, Kickoffs, and Punts</h3>
<p>Field goals and kickoffs are treated separately. The probability that a field goal is made is calculated using a general additive model using the (smoothed) distance of the kick as the predictor, calculated as the yard-line plus an additional 17 yards. Each field goal attempt’s expected points are weighted by the probability it is made (resulting in 3 expected points) and adjusted by the probability of a missed field goal (i.e. Pr(Missed FG) = 1 - Pr(Made FG)) and the resulting change in EPA due to changes in field position, down, etc. that would occur from the missed field goal.</p>
<p>Touch-backs are considered the standard expected outcome for kickoffs and anything returned past the 25 would be a points added situation and vice versa for those not returned to at least the 25. considered</p>
<p>PATs are not currently being treated separately, the extra point is treated as a given, which is less than ideal.</p>
<p>Punts are not treated separately, since their primary effect lies mostly in the change in field position. It is a situation the expected points model is well suited to predict on.</p>
</div>
</div>
<div id="field-position-and-expected-points" class="section level2">
<h2 class="hasAnchor">
<a href="#field-position-and-expected-points" class="anchor"></a>Field Position and Expected Points</h2>
<p>The model was trained on non-overtime data from 2014-2019 using leave-one-season-out cross-validation. This means the model holds one season for test data validation and uses the remaining seasons as the training set, then uses the trained model to make predictions on the season held out. This process is then iterated for each season in the data.</p>
<p><a href="https://imgur.com/g5rSRUX"><img src="https://i.imgur.com/g5rSRUXl.png" title="Figure: @SaiemGilani"></a></p>
<p>This is the plot of expected points in relation to field position alone, grouped in 10 yard bins and labeled on the plot with the mean expected points for the bin. The point at the bottom left is roughly the expected points from having the ball at the offense’s own 1-yard line, -1.28 expected points. The observed mean expected value for receiving the ball from the offense’s own 21-30-yard line (or 70 to 79 yards from opponent’s end-zone) is 0.29 expected points.</p>
<p>It should be no surprise that as offenses move closer to their opponent’s goal line, the expected points trend upward for the offense. Notice for the point representing the 30-39-yard line grouping, the expected points is right around the value of a field goal. This aligns with one of the common definitions of a scoring opportunity, giving support to the appropriateness of the definition.</p>
<p>The observed average expected points in the red-zone are 4.05 in the 10-19-yard line bin and 5.17 inside the 10, with plays at the 1-yard line averaging 6.06 expected points. Note: There are some plays that were input as yard 0 that I interpreted as an “&amp; inches” situation. There are 66 such plays (compared to 5.3k plays at the 1-yard line) and their observed mean expected points is 4.62.</p>
</div>
<div id="field-position-and-expected-points-by-down" class="section level2">
<h2 class="hasAnchor">
<a href="#field-position-and-expected-points-by-down" class="anchor"></a>Field Position and Expected Points by Down</h2>
<p>Recall that down and down interactions were three of the predictors in the model, so here is the field position view of expected points separated by down. The plot below demonstrates that your expected points are higher (on average) on 1st down than 2nd, and 2nd down than 3rd, etc at every point on the field, except possibly near the offense’s own goal line where there is risk of giving up a safety.</p>
<p><a href="https://imgur.com/S7etCxQ"><img src="https://i.imgur.com/S7etCxQl.png" title="Figure: @SaiemGilani"></a></p>
<p>This graph should be somewhat intuitive, but to understand what the relative expected points difference for each down at the same field position, we are interested in the vertical distance between each of the lines.</p>
</div>
<div id="st-and-2nd-down" class="section level2">
<h2 class="hasAnchor">
<a href="#st-and-2nd-down" class="anchor"></a>1st and 2nd Down</h2>
<p>Noting that, we see that difference between 1st and 2nd down is steady across most of the field from left to right, starting wider near the offense’s own goal line and narrowing as the offense progresses toward the opponent’s end-zone.</p>
</div>
<div id="nd-and-3rd-down" class="section level2">
<h2 class="hasAnchor">
<a href="#nd-and-3rd-down" class="anchor"></a>2nd and 3rd Down</h2>
<p>Examining the difference between the 2nd and 3rd down lines, the distance is much wider, doubling the relative difference between 1st and 2nd for most portions of the middle 60 yards of the field.</p>
</div>
<div id="rd-and-4th-down" class="section level2">
<h2 class="hasAnchor">
<a href="#rd-and-4th-down" class="anchor"></a>3rd and 4th Down</h2>
<p>Further yet is the 4th down line, which has an interesting track, narrowing closest to the other down lines around the 25 yard line.</p>
<p>Perhaps we should examine the next score probabilities underlying each of these down lines to see what drives these relative differences. More on that in Part 2, coming your way next.</p>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by <a href="https://twitter.com/saiemgilani">Saiem Gilani</a>, <a href="https://twitter.com/msubbaiah1">Meyappan Subbaiah</a>, <a href="https://twitter.com/JaredDLee">Jared Lee</a>, <a href="https://twitter.com/statsowar">Parker Fleming</a>.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
