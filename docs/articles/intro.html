<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Introduction to College Football Analytics with cfbscrapR • cfbscrapR</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/cosmo/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Introduction to College Football Analytics with cfbscrapR">
<meta property="og:description" content="cfbscrapR">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">cfbscrapR</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">1.0.1</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fa fa-home"></span>
     
  </a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    <span class="fa fa-question-circle-o"></span>
     
    Tutorials
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/index.html">Vignettes</a>
    </li>
    <li class="dropdown-header">Introductory</li>
    <li>
      <a href="../articles/intro.html">CFB Analytics with cfbscrapR</a>
    </li>
    <li class="dropdown-header">Expected Points Model Fundamentals</li>
    <li>
      <a href="../articles/College-Football-Expected-Points-Model-Fundamentals-Part-I.html">Part 1 - Model Definition</a>
    </li>
    <li>
      <a href="../articles/College-Football-Expected-Points-Model-Fundamentals-Part-II.html">Part 2 - Regression Models</a>
    </li>
    <li>
      <a href="../articles/College-Football-Expected-Points-Model-Fundamentals-Part-III.html">Part 3 - History of Expected Points Models</a>
    </li>
  </ul>
</li>
<li>
  <a href="../reference/index.html">
    <span class="fa fa-file-code-o"></span>
     
    Functions
  </a>
</li>
<li>
  <a href="../news/index.html">
    <span class="fa fa-newspaper-o"></span>
     
    News
  </a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://twitter.com/cfbscrapR">
    <span class="fab fa fab fa-twitter fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="https://github.com/saiemgilani/cfbscrapR/">
    <span class="fa fa-github fa-lg"></span>
     
    GitHub
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Introduction to College Football Analytics with cfbscrapR</h1>
                        <h4 class="author">Parker Fleming | <span class="citation">@statsowar</span>
</h4>
            
      
      
      <div class="hidden name"><code>intro.Rmd</code></div>

    </div>

    
    
<p>Hello, friends.</p>
<p>You, like me, might be a big college football fan who is interested in statistics and analytics, wanting to get into the game for yourself. This simple tutorial is just the way to do that!</p>
<p>The <code>cfbscrapR</code> package is just the way to get started with analytics. <code>cfbscrapR</code> is a wrapper for the <a href="collegefootballdata.com">CollegeFootballData.com</a> API, which lets you pull data directly from the site into the statistical software R for analysis. What kind of data can you get with <code>cfbscrapR</code>?</p>
<ul>
<li>Play-by-play data for every FBS game</li>
<li>Drive-level results for every FBS game</li>
<li>Game level stats, betting lines, home and away teams</li>
<li>Historical polls and SP+ Rankings</li>
<li>Recruiting Rankings</li>
<li>Coaching Data …and more!</li>
</ul>
<p>We’ll learn how to do three things in this document:</p>
<ol style="list-style-type: decimal">
<li>Pull and clean play-level and game-level data for current and past seasons.</li>
<li>Calculate yards per play, success rate, and rushing and passing EPA.</li>
<li>Learn some basics of visualizing those stats.</li>
</ol>
<p>I hope you enjoy! Know that there is a learning curve to all this! It’s difficult, and at times can be frustrating. The best way to learn this stuff is to play around with it, understand the syntax, and beat your head against the wall for a little bit until it works.</p>
<p>-Parker Fleming | <span class="citation">[@statsowar]</span>(twitter.com/statsowar)</p>
<div id="setting-up-r-and-r-studio" class="section level2">
<h2 class="hasAnchor">
<a href="#setting-up-r-and-r-studio" class="anchor"></a>Setting up R and R Studio</h2>
<p>First things first, you need to install R and download R Studio. I’ll direct you to this link LINK HERE. Go do that now, then come back.</p>
<p>Now that we have R and R Studio all put together, it’s time to get organized. That’s often the first step of any project working with data, and the more organized you can be, the easier of a time you’ll have trying to wrangle and analyze the data.</p>
<p>Notice there are four quadrants to your R Studio setup: the top right is the Evironment tab, which shows you the data, values, and functions you currently have loaded. The bottom right is where you’ll see your charts and graphs in the viewer or plots tab. The bottom left is the console, where output goes. When you execute code, the terminal responds and shows you some stuff down there. The top left is the place you’ll live; it’s where you can edit scripts. We’ll load a new project and then get started.</p>
<p>In the top right of your R Studio window, there will be a small dropdown menu that says “None”. Click it, and select “New Project.” Title your new folder something like “CFB Analysis”.</p>
<p>This takes care of setting your working directory, so everything you create and output will be saved in that folder.</p>
<p>What should pop up then is a completely fresh R project. Click the white square with a green plus sign in the top left of the window and select “New R Script”. A <em>script</em> is the place you will write your commands before you execute them. You can work in the console, which is just below the scripts and where output is displayed, but I find it easier to stick to scripts - that way, you can save what you’ve done and replicate it easily, like I do with the EPA rankings, for example.</p>
<p>Throughout this document, I’ll have lines of code interspersed with commentary. What I’d advise is that you read the commentary, then copy the code into your script and then run the code from there. Then, at the end, you’ll have a complete script that will guide you through CFB Data analysis.</p>
</div>
<div id="getting-the-data" class="section level1">
<h1 class="hasAnchor">
<a href="#getting-the-data" class="anchor"></a>Getting the Data</h1>
<p>What we’ll do here is a template for an initial data ingest. This will let you pull the play-by-play data, combine it with the game-level data, and then filter out FCS games and garbage time, should you so choose.</p>
<div id="install-the-necessary-packages-" class="section level2">
<h2 class="hasAnchor">
<a href="#install-the-necessary-packages-" class="anchor"></a>Install the necessary packages.</h2>
<p>To use the packages, we need to do two things. First, one time only on your machine, you need to install the pacakges. Then, every time you open up R Studio, you will need to load the packages.</p>
<p>To install the packages, simply run each line of code below once (without the ‘#’ at the beginning):</p>
<div class="sourceCode" id="cb1"><html><body><pre class="r">#install.packages('tidyverse')
#installpackages('easypackages')
#install.packages("devtools")
#devtools::install_github("meysubb/cfbscrapR")
#install.packages('ggimage')
#install.packages('gt')</pre></body></html></div>
<p>Don’t worry about what all that means for now. Now, after running those lines of code, you have all the pacakges you need to get started with college football analytics. Let’s load the pacakges and download the play-by-play data for 2019. First we load the three necessary packages, then we’re going to run a loop over the number of weeks in the season and use the <code><a href="../reference/cfb_pbp_data.html">cfb_pbp_data()</a></code> function, which pulls the play-by-play.</p>
<p>We’re going to pull the data, clean it, then select some relevant variables, and then we’ll go forward with moving the data.</p>
</div>
<div id="pull-the-data-from-the-api" class="section level2">
<h2 class="hasAnchor">
<a href="#pull-the-data-from-the-api" class="anchor"></a>Pull the data from the API</h2>
<p>Note in the code how we defined what pbp_2019 is: we used the little arrow. If you’re on mac, you can press option and the dash key to pull one of those little guys up. That’s just R’s fun way of saying “name that thing this”.</p>
<div class="sourceCode" id="cb2"><html><body><pre class="r"><span class="kw pkg">easypackages</span><span class="kw ns">::</span><span class="fu"><a href="https://rdrr.io/pkg/easypackages/man/libraries.html">libraries</a></span>(<span class="st">'tidyverse'</span>, <span class="st">'cfbscrapR'</span>, <span class="st">'ggimage'</span>, <span class="st">'gt'</span>)</pre></body></html></div>
<div class="sourceCode" id="cb3"><html><body><pre class="r"><span class="no">pbp_2019</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/cfb_pbp_data.html">cfb_pbp_data</a></span>(<span class="kw">year</span><span class="kw">=</span><span class="fl">2019</span>, <span class="kw">season_type</span> <span class="kw">=</span> <span class="st">"regular"</span>, <span class="kw">week</span><span class="kw">=</span><span class="kw">NULL</span>, <span class="kw">epa_wpa</span> <span class="kw">=</span> <span class="fl">TRUE</span>)</pre></body></html></div>
<p>This code will take a few minutes (~3:10) to run - it’s pulling a lot of data from the API at once. Give your R console a break until it finishes! You’ll know it’s done running when you can see “pbp_2019” in the “Environment” window in the top right of your R console (and when the little carot &gt; pops up in your terminal, at the bottom left).</p>
<p>Now, we have the entire season’s worth of play-by-play data stored in an object called “pbp_2019”. All of that text in the <code><a href="../reference/cfb_pbp_data.html">cfb_pbp_data()</a></code> is customizable: you could select only a specific week, you could pull data from bowl games by changing season_type to “both”. Finally, the epa_wpa = TRUE adds <code>cfbscrapR</code>’s EPA model and a bunch of useful stats and codes on the data!</p>
<p>Let’s pull the game data, using the <code><a href="../reference/cfb_game_info.html">cfb_game_info()</a></code> function, and merge the two. Then, we’ll make use of the <code>filter</code> and <code>mutate</code> functions from the <code>tidyverse</code>.</p>
<div class="sourceCode" id="cb4"><html><body><pre class="r"><span class="co">#Game level data</span>
<span class="no">games_19</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/cfb_game_info.html">cfb_game_info</a></span>(<span class="fl">2019</span>)

<span class="co">#Join Games and Play-by-Play</span>
<span class="no">plays19</span> <span class="kw">&lt;-</span> <span class="fu">left_join</span>(<span class="no">pbp_2019</span>, <span class="no">games_19</span>, <span class="kw">by</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"game_id"</span> <span class="kw">=</span> <span class="st">"id"</span>))</pre></body></html></div>
<p>Above, we pulled 2019 game data from the API into an object called “games_19”, and then we used <code>left_join</code> to merge each play to the information of the game it happened in, an object called “plays19”. We matched the plays to the games by telling R that the column “game_id” in pbp_2019 was the same as the column “id” in the games_19 object.</p>
</div>
<div id="clean-the-data" class="section level2">
<h2 class="hasAnchor">
<a href="#clean-the-data" class="anchor"></a>Clean the Data</h2>
<p>Before we break down what we did to create the pbp object, we need to discuss two things:</p>
<ol style="list-style-type: decimal">
<li><p>Filtering on conditions: We will use the double equality (==) to identify conditions we need to meet for our filter function. We can also use !=, “not equals”, to select values on that condition (i.e. offense_play != “TCU” would remove TCU from the data), and we can use the standard greater than &gt; and less than &lt;. You might have to stop and think a bit before you write your filter function, so just make sure you know what it is you are actually selecting.</p></li>
<li><p>the <em>pipe</em>: %&gt;% is the magrittr pipe. The pipe is extremely handy. Instead of us having to type a function and select the data we want to apply that function to over and over again, the pipe tells R what to do in the structure of : “get this thing and then do this to it.”</p></li>
</ol>
<p>I’m naming our dataset of play by play data filtered “pbp”. I don’t like to overwrite my data once I’ve imported it, so I’m going to give it a new name. That way, if I mess something up along the way, I can go back to the start and clean up without too much hassle.</p>
<p>We’ll use the indicator variables “rush” and “pass” to select every play categorized as rushes or passes. (Yes, this leaves out special teams and yes this leaves out penalties. We’re starting small, and can always go back later.)</p>
<p>Also note we use the | symbol to denote “or” in our filter function. We’ll filter the data for any observations that are runs (rush == 1) or passes (pass == 1), and store it in a new object called plays.</p>
<p>But we won’t stop there! The beauty of the pipe is that we can do multiple operations, all strung together. So, in the code below, we’ll create a new object called “pbp”. To create this object, we’ll do three things:</p>
<ol style="list-style-type: decimal">
<li>Take plays19, remove all plays that aren’t rushes or passes: <code><a href="https://rdrr.io/r/stats/filter.html">filter(rush == 1 | pass == 1)</a></code> AND THEN<br>
</li>
<li>Remove all FCS teams. This is a personal preference of mine, and if you’d like to leave those in the data, you can certainly remove this line! It’s a good way to illustrate how you’d do this, though. By using filter(), I tell R to select all observations that are <em>not</em> (!) missing the variable home_conference or away_conference. As all FBS teams have a conference in the data, this will remove all FCS teams. <strong>Note</strong>: is.na(x) means “is missing variable x”, so !is.na(x) means “is not missing variable x.”<br>
</li>
<li>Create new variables! <code>mutate()</code> is R’s weird way of saying “make a new variable!” So, we’ll create three new variables:<br>
</li>
</ol>
<ol style="list-style-type: lower-roman">
<li>
<code>abs_diff</code> is the absolute value of the score difference, created using the abs() function. This variable helps us define the garbage time filter.<br>
</li>
<li>
<code>garbage</code> is an indicator variable for whether a play is in garbage time, as defined by our friend Bill Connelly. Garbage time is when the score difference is greater than 43 in the first quarter, 37 in the second quarter, 27 in the third quarter, and 22 in the fourth quarter. To create this variable, we use the <code><a href="https://rdrr.io/r/base/ifelse.html">ifelse()</a></code>, which takes three arguments: a condition, yes, and no. ifelse basically says “if this condition is met, then make this variable this value, or do something else.” We’ve strung multiple ifelse() conditions together to cover all of our bases.<br>
</li>
<li>
<code>success</code>: We use the same <code><a href="https://rdrr.io/r/base/ifelse.html">ifelse()</a></code> logic to create a binary variable that indicates whether a play was successful or not, again, as defined by Bill C.</li>
</ol>
<div class="sourceCode" id="cb5"><html><body><pre class="r"><span class="co">#Create Garbage time filter, eliminate FCS games, </span>
<span class="co">#filter for only rushes and passes, create success variable</span>
<span class="no">pbp</span> <span class="kw">&lt;-</span> <span class="no">plays19</span> <span class="kw">%&gt;%</span> <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span>(<span class="no">rush</span> <span class="kw">==</span> <span class="fl">1</span><span class="kw">|</span> <span class="no">pass</span> <span class="kw">==</span> <span class="fl">1</span>) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span>(!<span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span>(<span class="no">home_conference</span>) <span class="kw">&amp;</span> !<span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span>(<span class="no">away_conference</span>)) <span class="kw">%&gt;%</span>
  <span class="fu">mutate</span>(<span class="kw">abs_diff</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">abs</a></span>(<span class="no">score_diff</span>),
         <span class="kw">garbage</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span>(<span class="no">period</span> <span class="kw">==</span> <span class="fl">1</span> <span class="kw">&amp;</span> <span class="no">abs_diff</span> <span class="kw">&gt;</span> <span class="fl">43</span>, <span class="fl">1</span>,
                   <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span>(<span class="no">period</span> <span class="kw">==</span> <span class="fl">2</span> <span class="kw">&amp;</span> <span class="no">abs_diff</span> <span class="kw">&gt;</span> <span class="fl">37</span>, <span class="fl">1</span>,
                   <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span>(<span class="no">period</span> <span class="kw">==</span> <span class="fl">3</span> <span class="kw">&amp;</span> <span class="no">abs_diff</span> <span class="kw">&gt;</span> <span class="fl">27</span>, <span class="fl">1</span>,
                   <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span>(<span class="no">period</span> <span class="kw">==</span> <span class="fl">4</span> <span class="kw">&amp;</span> <span class="no">abs_diff</span> <span class="kw">&gt;</span> <span class="fl">22</span>, <span class="fl">1</span>, <span class="fl">0</span>)))),
         <span class="kw">success</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span>(<span class="no">down</span> <span class="kw">==</span> <span class="fl">1</span> <span class="kw">&amp;</span> <span class="no">yards_gained</span> <span class="kw">&gt;</span> <span class="fl">.5</span>*<span class="no">distance</span>, <span class="fl">1</span>,
                   <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span>(<span class="no">down</span> <span class="kw">==</span> <span class="fl">2</span> <span class="kw">&amp;</span> <span class="no">yards_gained</span> <span class="kw">&gt;</span> <span class="fl">.7</span>*<span class="no">distance</span>, <span class="fl">1</span>,
                   <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span>((<span class="no">down</span> <span class="kw">==</span> <span class="fl">3</span> <span class="kw">|</span> <span class="no">down</span> <span class="kw">==</span> <span class="fl">4</span>) <span class="kw">&amp;</span> <span class="no">yards_gained</span> <span class="kw">&gt;=</span><span class="no">distance</span>, <span class="fl">1</span>, <span class="fl">0</span>))))</pre></body></html></div>
<p>Now we have a clean dataset of every rush and pass that happened in 2019. (Quick note: unfortunately, due to the way the pbp data is generated on ESPN, QB scrambles from dropbacks are coded as rushes. It’s not ideal, but it’s not a dealbreaker; just something to remember as you do your analysis).</p>
<p>Let’s look at it!</p>
<div class="sourceCode" id="cb6"><html><body><pre class="r"><span class="fu">glimpse</span>(<span class="no">pbp</span>)</pre></body></html></div>
<pre><code>## Rows: 100,699
## Columns: 110
## $ game_id                   &lt;int&gt; 401110720, 401110720, 401110720, 401110720,…
## $ drive_number              &lt;int&gt; 1, 1, 1, 2, 2, 2, 3, 3, 4, 4, 4, 4, 4, 4, 4…
## $ drive_play_number         &lt;dbl&gt; 2, 3, 4, 1, 2, 3, 1, 2, 1, 2, 3, 4, 5, 6, 7…
## $ game_play_number          &lt;dbl&gt; 2, 3, 4, 6, 7, 8, 10, 11, 12, 13, 14, 15, 1…
## $ offense_play              &lt;chr&gt; "Alabama", "Alabama", "Alabama", "Duke", "D…
## $ defense_play              &lt;chr&gt; "Duke", "Duke", "Duke", "Alabama", "Alabama…
## $ half                      &lt;fct&gt; 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1…
## $ period                    &lt;int&gt; 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1…
## $ clock.minutes             &lt;dbl&gt; 29, 29, 28, 27, 27, 26, 26, 26, 26, 25, 25,…
## $ clock.seconds             &lt;int&gt; 46, 15, 30, 50, 27, 55, 42, 24, 11, 46, 13,…
## $ play_type                 &lt;chr&gt; "Rush", "Pass Reception", "Sack", "Rush", "…
## $ play_text                 &lt;chr&gt; "Jerome Ford run for 1 yd to the Alab 23", …
## $ down                      &lt;dbl&gt; 1, 2, 3, 1, 2, 3, 1, 2, 1, 2, 3, 1, 2, 3, 4…
## $ distance                  &lt;int&gt; 10, 9, 7, 10, 11, 7, 10, 4, 10, 5, 5, 10, 8…
## $ yards_to_goal             &lt;dbl&gt; 78, 77, 75, 55, 56, 52, 83, 77, 26, 21, 21,…
## $ yards_gained              &lt;int&gt; 1, 2, -6, -1, 4, 0, 6, 3, 5, 0, 5, 2, 0, 7,…
## $ offense_score             &lt;int&gt; 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0…
## $ defense_score             &lt;int&gt; 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0…
## $ score_diff                &lt;int&gt; 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0…
## $ EPA                       &lt;dbl&gt; -0.75653413, -0.80455228, -1.87692365, -0.9…
## $ ep_before                 &lt;dbl&gt; 0.383715944, -0.372818190, -1.177370469, 2.…
## $ ep_after                  &lt;dbl&gt; -0.3728182, -1.1773705, -3.0542941, 1.51576…
## $ def_EPA                   &lt;dbl&gt; 0.75653413, 0.80455228, 1.87692365, 0.99761…
## $ ppa                       &lt;chr&gt; "-0.51421952939679995", "-0.227264862029380…
## $ wpa                       &lt;dbl&gt; -0.029134787, -0.029645452, -0.077583715, -…
## $ wp                        &lt;dbl&gt; 0.4863020, 0.4571672, 0.4275217, 0.5940228,…
## $ def_wp                    &lt;dbl&gt; 0.5136980, 0.5428328, 0.5724783, 0.4059772,…
## $ lead_wp                   &lt;dbl&gt; 0.4571672, 0.4275217, 0.3499380, 0.5537061,…
## $ Goal_To_Go                &lt;lgl&gt; FALSE, FALSE, FALSE, FALSE, FALSE, FALSE, F…
## $ Under_two                 &lt;lgl&gt; FALSE, FALSE, FALSE, FALSE, FALSE, FALSE, F…
## $ offense_timeouts          &lt;int&gt; 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3…
## $ defense_timeouts          &lt;int&gt; 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3…
## $ drive_start_yards_to_goal &lt;int&gt; 78, 78, 78, 55, 55, 55, 83, 83, 26, 26, 26,…
## $ drive_end_yards_to_goal   &lt;int&gt; 81, 81, 81, 52, 52, 52, 77, 77, 7, 7, 7, 7,…
## $ drive_yards               &lt;int&gt; -3, -3, -3, 3, 3, 3, 9, 9, 19, 19, 19, 19, …
## $ drive_scoring             &lt;lgl&gt; FALSE, FALSE, FALSE, FALSE, FALSE, FALSE, F…
## $ drive_result              &lt;chr&gt; "PUNT", "PUNT", "PUNT", "PUNT", "PUNT", "PU…
## $ drive_pts                 &lt;dbl&gt; 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0…
## $ home                      &lt;chr&gt; "Alabama", "Alabama", "Alabama", "Alabama",…
## $ away                      &lt;chr&gt; "Duke", "Duke", "Duke", "Duke", "Duke", "Du…
## $ home_wp                   &lt;dbl&gt; 0.4863020, 0.4571672, 0.4275217, 0.4059772,…
## $ away_wp                   &lt;dbl&gt; 0.5136980, 0.5428328, 0.5724783, 0.5940228,…
## $ TimeSecsRem               &lt;dbl&gt; 1786, 1755, 1710, 1670, 1647, 1615, 1602, 1…
## $ down_end                  &lt;fct&gt; 2, 3, 4, 2, 3, 4, 2, 1, 2, 3, 1, 2, 3, 4, 1…
## $ distance_end              &lt;dbl&gt; 9, 7, 13, 11, 7, 7, 4, 10, 5, 5, 10, 8, 8, …
## $ yards_to_goal_end         &lt;dbl&gt; 77, 75, 81, 56, 52, 52, 77, 26, 21, 21, 16,…
## $ TimeSecsRem_end           &lt;dbl&gt; 1755, 1710, 1677, 1647, 1615, 1609, 1584, 1…
## $ id_play                   &lt;chr&gt; "401110720101855301", "401110720101858401",…
## $ offense_conference        &lt;chr&gt; "SEC", "SEC", "SEC", "ACC", "ACC", "ACC", "…
## $ drive_id                  &lt;dbl&gt; 4011107201, 4011107201, 4011107201, 4011107…
## $ play_number               &lt;int&gt; 2, 3, 4, 1, 2, 3, 1, 2, 1, 2, 3, 4, 5, 6, 7…
## $ scoring                   &lt;lgl&gt; FALSE, FALSE, FALSE, FALSE, FALSE, FALSE, F…
## $ drive_start_yardline      &lt;int&gt; 22, 22, 22, 55, 55, 55, 17, 17, 26, 26, 26,…
## $ drive_end_time.hours      &lt;int&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA,…
## $ drive_elapsed.hours       &lt;int&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA,…
## $ penalty_flag              &lt;lgl&gt; FALSE, FALSE, FALSE, FALSE, FALSE, FALSE, F…
## $ penalty_declined          &lt;lgl&gt; FALSE, FALSE, FALSE, FALSE, FALSE, FALSE, F…
## $ penalty_no_play           &lt;lgl&gt; FALSE, FALSE, FALSE, FALSE, FALSE, FALSE, F…
## $ penalty_offset            &lt;lgl&gt; FALSE, FALSE, FALSE, FALSE, FALSE, FALSE, F…
## $ penalty_1st_conv          &lt;lgl&gt; FALSE, FALSE, FALSE, FALSE, FALSE, FALSE, F…
## $ new_id                    &lt;dbl&gt; 101855301, 101858401, 101866901, 101874901,…
## $ turnover                  &lt;dbl&gt; 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 1…
## $ downs_turnover            &lt;dbl&gt; 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1…
## $ half_play_number          &lt;dbl&gt; 2, 3, 4, 6, 7, 8, 10, 11, 12, 13, 14, 15, 1…
## $ off_timeouts_rem_before   &lt;dbl&gt; 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3…
## $ def_timeouts_rem_before   &lt;dbl&gt; 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3…
## $ missing_yard_flag         &lt;lgl&gt; FALSE, FALSE, FALSE, FALSE, FALSE, FALSE, F…
## $ adj_TimeSecsRem           &lt;dbl&gt; 3586, 3555, 3510, 3470, 3447, 3415, 3402, 3…
## $ home_EPA                  &lt;dbl&gt; -0.75653413, -0.80455228, -1.87692365, 0.99…
## $ away_EPA                  &lt;dbl&gt; 0.75653413, 0.80455228, 1.87692365, -0.9976…
## $ ExpScoreDiff              &lt;dbl&gt; 0.383715944, -0.372818190, -1.177370469, 2.…
## $ ExpScoreDiff_Time_Ratio   &lt;dbl&gt; 1.069741e-04, -1.048420e-04, -3.353376e-04,…
## $ rz_play                   &lt;dbl&gt; 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 1, 1…
## $ scoring_opp               &lt;dbl&gt; 0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 1, 1, 1, 1, 1…
## $ pass                      &lt;dbl&gt; 0, 1, 1, 0, 0, 1, 0, 0, 0, 0, 0, 0, 1, 0, 0…
## $ rush                      &lt;dbl&gt; 1, 0, 0, 1, 1, 0, 1, 1, 1, 1, 1, 1, 0, 1, 1…
## $ stuffed_run               &lt;dbl&gt; 0, 0, 0, 1, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1…
## $ success                   &lt;dbl&gt; 0, 0, 0, 0, 0, 0, 1, 1, 0, 0, 1, 0, 0, 0, 0…
## $ epa_success               &lt;dbl&gt; 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 1, 0, 0, 0, 0…
## $ spread                    &lt;dbl&gt; -34.5, -34.5, -34.5, -34.5, -34.5, -34.5, -…
## $ formatted_spread          &lt;chr&gt; "Alabama -34.5", "Alabama -34.5", "Alabama …
## $ change_of_poss            &lt;dbl&gt; 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 1…
## $ end_of_half               &lt;dbl&gt; 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0…
## $ wpa_base                  &lt;dbl&gt; -0.029134787, -0.029645452, -0.077583715, -…
## $ wpa_change                &lt;dbl&gt; -0.029134787, -0.029645452, -0.077583715, -…
## $ home_wp_post              &lt;dbl&gt; 0.4571672, 0.4275217, 0.3499380, 0.4462939,…
## $ away_wp_post              &lt;dbl&gt; 0.5428328, 0.5724783, 0.6500620, 0.5537061,…
## $ season                    &lt;int&gt; 2019, 2019, 2019, 2019, 2019, 2019, 2019, 2…
## $ week                      &lt;int&gt; 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1…
## $ season_type               &lt;chr&gt; "regular", "regular", "regular", "regular",…
## $ start_date                &lt;chr&gt; "2019-08-31T19:30:00.000Z", "2019-08-31T19:…
## $ start_time_tbd            &lt;lgl&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA,…
## $ neutral_site              &lt;lgl&gt; TRUE, TRUE, TRUE, TRUE, TRUE, TRUE, TRUE, T…
## $ conference_game           &lt;lgl&gt; FALSE, FALSE, FALSE, FALSE, FALSE, FALSE, F…
## $ attendance                &lt;int&gt; 71916, 71916, 71916, 71916, 71916, 71916, 7…
## $ venue_id                  &lt;int&gt; 5348, 5348, 5348, 5348, 5348, 5348, 5348, 5…
## $ venue                     &lt;chr&gt; "Mercedes-Benz Stadium", "Mercedes-Benz Sta…
## $ home_id                   &lt;int&gt; 333, 333, 333, 333, 333, 333, 333, 333, 333…
## $ home_team                 &lt;chr&gt; "Alabama", "Alabama", "Alabama", "Alabama",…
## $ home_conference           &lt;chr&gt; "SEC", "SEC", "SEC", "SEC", "SEC", "SEC", "…
## $ home_points               &lt;int&gt; 42, 42, 42, 42, 42, 42, 42, 42, 42, 42, 42,…
## $ home_post_win_prob        &lt;chr&gt; "0.999990884676356", "0.999990884676356", "…
## $ away_id                   &lt;int&gt; 150, 150, 150, 150, 150, 150, 150, 150, 150…
## $ away_team                 &lt;chr&gt; "Duke", "Duke", "Duke", "Duke", "Duke", "Du…
## $ away_conference           &lt;chr&gt; "ACC", "ACC", "ACC", "ACC", "ACC", "ACC", "…
## $ away_points               &lt;int&gt; 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3…
## $ away_post_win_prob        &lt;chr&gt; "0.00000911532364400447", "0.00000911532364…
## $ excitement_index          &lt;chr&gt; "0.4601882762", "0.4601882762", "0.46018827…
## $ abs_diff                  &lt;int&gt; 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0…
## $ garbage                   &lt;dbl&gt; 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0…</code></pre>
<p>Ok, wow! We have more than 100,000 observations in our dataset, and 109 variables. These variables include play details, like down, distance, and yard line (yards_to_goal), as well as results - was it a rush or a pass? How many yards were gained? Was it a scoring play? For our initial analysis today, we’ll focus on <em>yards gained</em>, <em>success rate</em>, and <em>expected points added</em>, so let’s use the <code>select()</code> function to grab some play and team details, plus those variables.</p>
<div class="sourceCode" id="cb8"><html><body><pre class="r"><span class="no">plays</span> <span class="kw">&lt;-</span> <span class="no">pbp</span> <span class="kw">%&gt;%</span> <span class="fu">select</span>(<span class="no">offense_play</span>, <span class="no">defense_play</span>, <span class="no">down</span>, <span class="no">distance</span>, <span class="no">yards_to_goal</span>, <span class="no">rush</span>, <span class="no">pass</span>, <span class="no">yards_gained</span>, <span class="no">play_text</span>, <span class="no">success</span>, <span class="no">EPA</span>, <span class="no">garbage</span>)</pre></body></html></div>
<p>Now we have our relevant data, so let’s make do some stats!</p>
</div>
<div id="creating-some-stats" class="section level2">
<h2 class="hasAnchor">
<a href="#creating-some-stats" class="anchor"></a>Creating Some Stats</h2>
<p>Ok, now let’s play with the tidyverse a little more. We’ve used filter(), which is an extremely useful function. The next most useful functions actually do things to the data: <code>group_by()</code>, and <code>summarise()</code>.</p>
<p>Summarise is the way of creating season-long or game-by-game stats. Let’s start with some season long raw offense numbers, yards per attempt (passing) and yards per rush. We’re going to use the pipe (%&gt;%) to tell R to grab our plays dataset, group it by offense team, and summarize their yards per attempt and yards per rush in a new object called offense.</p>
<p>To create a conditional mean, like “the mean of yards_gained when pass == 1”, all you’ll do is add the condition you want in brackets inside your mean() function.</p>
<div class="sourceCode" id="cb9"><html><body><pre class="r"><span class="no">offense</span> <span class="kw">&lt;-</span> <span class="no">plays</span> <span class="kw">%&gt;%</span> <span class="fu">group_by</span>(<span class="no">offense_play</span>) <span class="kw">%&gt;%</span>
<span class="fu">summarise</span>(<span class="kw">ypa</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span>(<span class="no">yards_gained</span>[<span class="no">pass</span><span class="kw">==</span><span class="fl">1</span>]),
          <span class="kw">ypr</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span>(<span class="no">yards_gained</span>[<span class="no">rush</span><span class="kw">==</span><span class="fl">1</span>]))</pre></body></html></div>
<p>Now we can ask and answer some fun questions. Who had the best rushing offense, on a per play basis? Who had the best passing offense, on a per-play basis? We will do this using the arrange(desc()) function, which tells R to order the data from greatest to least (descending).</p>
<div class="sourceCode" id="cb10"><html><body><pre class="r"><span class="no">offense</span> <span class="kw">%&gt;%</span> <span class="fu">arrange</span>(<span class="fu">desc</span>(<span class="no">ypr</span>))</pre></body></html></div>
<pre><code>## # A tibble: 130 x 3
##    offense_play        ypa   ypr
##    &lt;chr&gt;             &lt;dbl&gt; &lt;dbl&gt;
##  1 Oklahoma           9.49  6.56
##  2 Kentucky           4.89  6.55
##  3 Clemson            8.13  6.50
##  4 Louisiana          7.21  6.39
##  5 Ohio State         8.37  6.37
##  6 Navy               9.06  6.37
##  7 Oklahoma State     6.61  6.25
##  8 Western Michigan   6.61  6.12
##  9 Mississippi State  5.82  6.06
## 10 Ole Miss           6.20  6.01
## # … with 120 more rows</code></pre>
<div class="sourceCode" id="cb12"><html><body><pre class="r"><span class="no">offense</span> <span class="kw">%&gt;%</span> <span class="fu">arrange</span>(<span class="no">ypa</span>)</pre></body></html></div>
<pre><code>## # A tibble: 130 x 3
##    offense_play       ypa   ypr
##    &lt;chr&gt;            &lt;dbl&gt; &lt;dbl&gt;
##  1 Northwestern      3.96  4.79
##  2 Akron             4.12  3.41
##  3 Old Dominion      4.20  4.14
##  4 Duke              4.22  4.11
##  5 UMass             4.27  4.29
##  6 Maryland          4.33  5.83
##  7 Vanderbilt        4.40  4.89
##  8 South Florida     4.52  5.59
##  9 Georgia Tech      4.53  5.10
## 10 Georgia Southern  4.55  5.40
## # … with 120 more rows</code></pre>
<p>I took out the desc() part of the function to display the worst offenses, for fun. We see that Oklahoma had the highest yards per rush, followed by Oklahoma, Kentucky, and Louisiana. The top passing teams were Air Force, Alabama, LSU, and Oklahoma. Bonus points if you can tell me why Air Force is ranked that highly!</p>
<p>The worst offenses for rushing and passing were West Virginia, who averaged only 3.15 yards per rush, and Northwestern, who averaged an inconceivable 3.96 yards per passing attempt.</p>
<p>We can easily do the defensive side of the ball as well, grouping plays instead by defense_play. Let’s make a dataset and then use <code>left_join()</code> to put offenses and defenses together, but let’s do EPA instead of yards, because EPA is more fun. (What’s EPA? Glad you asked: <a href="https://www.frogsowar.com/2019/8/13/20802128/expected-points-big-12-college-football-analytics">An EPA Primer</a>.</p>
<p>For the tutorial, I’ve included the <code><a href="https://rdrr.io/r/utils/head.html">head()</a></code> function as a quick way to look at the top values of our data. In your console, though, with the <code>view()</code> command, you can pull up the data in a traditional spreadsheet kind of format, which can help you parse through and see what you’re working with, or see results you’ve created.</p>
<div class="sourceCode" id="cb14"><html><body><pre class="r"><span class="no">offense</span> <span class="kw">&lt;-</span> <span class="no">plays</span> <span class="kw">%&gt;%</span> <span class="fu">group_by</span>(<span class="no">offense_play</span>) <span class="kw">%&gt;%</span>
  <span class="fu">summarise</span>(<span class="kw">epa.pass.off</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span>(<span class="no">EPA</span>[<span class="no">pass</span><span class="kw">==</span><span class="fl">1</span>]), <span class="kw">epa.rush.off</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span>(<span class="no">EPA</span>[<span class="no">rush</span><span class="kw">==</span><span class="fl">1</span>]))
<span class="no">defense</span> <span class="kw">&lt;-</span> <span class="no">plays</span> <span class="kw">%&gt;%</span> <span class="fu">group_by</span>(<span class="no">defense_play</span>) <span class="kw">%&gt;%</span>
  <span class="fu">summarise</span>(<span class="kw">epa.pass.def</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span>(<span class="no">EPA</span>[<span class="no">pass</span><span class="kw">==</span><span class="fl">1</span>]), <span class="kw">epa.pass.def</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span>(<span class="no">EPA</span>[<span class="no">rush</span><span class="kw">==</span><span class="fl">1</span>]))</pre></body></html></div>
<div class="sourceCode" id="cb15"><html><body><pre class="r"><span class="no">team.epa</span> <span class="kw">&lt;-</span> <span class="fu">left_join</span>(<span class="no">offense</span>, <span class="no">defense</span>, <span class="kw">by</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"offense_play"</span> <span class="kw">=</span> <span class="st">"defense_play"</span>))
<span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span>(<span class="no">team.epa</span>)</pre></body></html></div>
<pre><code>## # A tibble: 6 x 4
##   offense_play      epa.pass.off epa.rush.off epa.pass.def
##   &lt;chr&gt;                    &lt;dbl&gt;        &lt;dbl&gt;        &lt;dbl&gt;
## 1 Air Force               0.573        0.0687      -0.0631
## 2 Akron                  -0.307       -0.310       -0.0280
## 3 Alabama                 0.520        0.0929      -0.0875
## 4 Appalachian State       0.202        0.0606      -0.116 
## 5 Arizona                -0.0446       0.0531       0.0544
## 6 Arizona State           0.105       -0.0574      -0.137</code></pre>
<p>In analytics, we often want to break down situations. Let’s use <code>filter</code> to select only first down plays and see which offenses performed the best on first downs only:</p>
<div class="sourceCode" id="cb17"><html><body><pre class="r"><span class="no">offense</span> <span class="kw">&lt;-</span> <span class="no">plays</span> <span class="kw">%&gt;%</span> <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span>(<span class="no">down</span> <span class="kw">==</span> <span class="fl">1</span>) <span class="kw">%&gt;%</span> <span class="fu">group_by</span>(<span class="no">offense_play</span>) <span class="kw">%&gt;%</span>
  <span class="fu">summarise</span>(<span class="kw">epa.pass.off</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span>(<span class="no">EPA</span>[<span class="no">pass</span><span class="kw">==</span><span class="fl">1</span>]), <span class="kw">epa.rush.off</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span>(<span class="no">EPA</span>[<span class="no">rush</span><span class="kw">==</span><span class="fl">1</span>]))</pre></body></html></div>
<div class="sourceCode" id="cb18"><html><body><pre class="r"><span class="no">defense</span> <span class="kw">&lt;-</span> <span class="no">plays</span> <span class="kw">%&gt;%</span> <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span>(<span class="no">down</span> <span class="kw">==</span> <span class="fl">1</span>) <span class="kw">%&gt;%</span> <span class="fu">group_by</span>(<span class="no">defense_play</span>) <span class="kw">%&gt;%</span>
  <span class="fu">summarise</span>(<span class="kw">epa.pass.def</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span>(<span class="no">EPA</span>[<span class="no">pass</span><span class="kw">==</span><span class="fl">1</span>]), <span class="kw">epa.pass.def</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span>(<span class="no">EPA</span>[<span class="no">rush</span><span class="kw">==</span><span class="fl">1</span>]))</pre></body></html></div>
<div class="sourceCode" id="cb19"><html><body><pre class="r"><span class="no">firstdown.epa</span> <span class="kw">&lt;-</span> <span class="fu">left_join</span>(<span class="no">offense</span>, <span class="no">defense</span>, <span class="kw">by</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"offense_play"</span> <span class="kw">=</span> <span class="st">"defense_play"</span>))

<span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span>(<span class="no">firstdown.epa</span>)</pre></body></html></div>
<pre><code>## # A tibble: 6 x 4
##   offense_play      epa.pass.off epa.rush.off epa.pass.def
##   &lt;chr&gt;                    &lt;dbl&gt;        &lt;dbl&gt;        &lt;dbl&gt;
## 1 Air Force               0.632       -0.0614      -0.241 
## 2 Akron                  -0.269       -0.368       -0.0394
## 3 Alabama                 0.375        0.128       -0.0589
## 4 Appalachian State      -0.0212      -0.0649      -0.211 
## 5 Arizona                -0.103       -0.0930       0.139 
## 6 Arizona State          -0.0452      -0.140       -0.224</code></pre>
<p>Easy! You can make any kind of filter you can think of, and analyse EPA or yards gained in any situation.</p>
<p>Lastly, let’s do an example of creating some rates and using some advanced filters: We’ll create success rate on early downs and early downs rush rate, filtering out garabge time. We’ll use the same filter, summarise, and mean functions as above!</p>
<div class="sourceCode" id="cb21"><html><body><pre class="r"><span class="no">success</span> <span class="kw">&lt;-</span> <span class="no">plays</span> <span class="kw">%&gt;%</span> <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span>(<span class="no">garbage</span> <span class="kw">==</span> <span class="fl">0</span> <span class="kw">&amp;</span> <span class="no">down</span> <span class="kw">&lt;</span> <span class="fl">3</span>) <span class="kw">%&gt;%</span>
  <span class="fu">group_by</span>(<span class="no">offense_play</span>) <span class="kw">%&gt;%</span>
  <span class="fu">summarise</span>(<span class="kw">success.rte</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span>(<span class="no">success</span>),
            <span class="kw">rush.rte</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span>(<span class="no">rush</span>))</pre></body></html></div>
<div class="sourceCode" id="cb22"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span>(<span class="no">success</span>)</pre></body></html></div>
<pre><code>## # A tibble: 6 x 3
##   offense_play      success.rte rush.rte
##   &lt;chr&gt;                   &lt;dbl&gt;    &lt;dbl&gt;
## 1 Air Force               0.427    0.862
## 2 Akron                   0.288    0.394
## 3 Alabama                 0.482    0.449
## 4 Appalachian State       0.384    0.633
## 5 Arizona                 0.36     0.524
## 6 Arizona State           0.392    0.531</code></pre>
</div>
<div id="visualization" class="section level2">
<h2 class="hasAnchor">
<a href="#visualization" class="anchor"></a>Visualization</h2>
<p>We have some pretty data, now let’s learn how to make a basic <code>ggplot()</code> to visualize our data! We didn’t have to load ggplot(), it’s included in the tidyverse. We’ll take the success data from above, and start with a basic plot, then add some fancy formatting.</p>
<p>The syntax here is pretty simple: we will grab our dataset and use the pipe to say “open a plot”. Then we’ll tell the plot what the x and y coordinates are, then indicate the markers, in this case a scatterplot with geom_point(). Notice that we use + instead of %&gt;% once we’ve called ggplot(). The syntax here tells R to take the `success’ object and open a plot with the x.axis rush.rte and the y.axis success.rte, PLUS all these features. That can be a little confusing to keep straightforward, but R will tell you what’s going on with an error if you mix that up!</p>
<div class="sourceCode" id="cb24"><html><body><pre class="r"><span class="no">success</span> <span class="kw">%&gt;%</span> <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="kw">x</span><span class="kw">=</span><span class="no">rush.rte</span>, <span class="kw">y</span><span class="kw">=</span><span class="no">success.rte</span>)) + <span class="fu">geom_point</span>()</pre></body></html></div>
<p><img src="intro_files/figure-html/successplot-1.png" width="700"></p>
<p>Ok, that’s pretty cool! Let’s dress it up a little bit by adding a title and labelling the axes, using the labs() option. We will also throw a couple reference lines - a vertical and horizontal line indicating the mean values of each statistic to help us compare. Plus, here are some tweaks I like that make the graph look a little better (all the theme() stuff).</p>
<div class="sourceCode" id="cb25"><html><body><pre class="r"><span class="no">success</span> <span class="kw">%&gt;%</span> <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="kw">x</span><span class="kw">=</span><span class="no">rush.rte</span>, <span class="kw">y</span><span class="kw">=</span><span class="no">success.rte</span>)) + <span class="fu">geom_point</span>() +
  <span class="fu">geom_vline</span>(<span class="kw">xintercept</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span>(<span class="no">success</span>$<span class="no">rush.rte</span>), <span class="kw">linetype</span> <span class="kw">=</span> <span class="st">"dashed"</span>, <span class="kw">color</span> <span class="kw">=</span> <span class="st">"red"</span>, <span class="kw">alpha</span> <span class="kw">=</span> <span class="fl">0.5</span>) +
  <span class="fu">geom_hline</span>(<span class="kw">yintercept</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span>(<span class="no">success</span>$<span class="no">success.rte</span>), <span class="kw">linetype</span> <span class="kw">=</span> <span class="st">"dashed"</span>, <span class="kw">color</span> <span class="kw">=</span> <span class="st">"red"</span>, <span class="kw">alpha</span> <span class="kw">=</span> <span class="fl">0.5</span>) +
  <span class="fu">labs</span>(<span class="kw">x</span> <span class="kw">=</span> <span class="st">"Early Downs Rush Rate"</span>, <span class="kw">y</span><span class="kw">=</span> <span class="st">"Success Rate"</span>,
       <span class="kw">title</span> <span class="kw">=</span> <span class="st">"2019 FBS Early Downs Rush Rate and Success"</span>) +
  <span class="fu">theme_minimal</span>() +
    <span class="fu">theme</span>(<span class="kw">axis.title</span> <span class="kw">=</span> <span class="fu">element_text</span>(<span class="kw">size</span> <span class="kw">=</span> <span class="fl">12</span>),
    <span class="kw">axis.text</span> <span class="kw">=</span> <span class="fu">element_text</span>(<span class="kw">size</span> <span class="kw">=</span> <span class="fl">10</span>),
    <span class="kw">plot.title</span> <span class="kw">=</span> <span class="fu">element_text</span>(<span class="kw">size</span> <span class="kw">=</span> <span class="fl">20</span>),
    <span class="kw">plot.subtitle</span> <span class="kw">=</span> <span class="fu">element_text</span>(<span class="kw">size</span> <span class="kw">=</span> <span class="fl">14</span>),
        <span class="kw">plot.caption</span> <span class="kw">=</span> <span class="fu">element_text</span>(<span class="kw">size</span> <span class="kw">=</span> <span class="fl">12</span>),
    <span class="kw">panel.grid.minor</span> <span class="kw">=</span> <span class="fu">element_blank</span>())</pre></body></html></div>
<p><img src="intro_files/figure-html/successearlyrush-1.png" width="700"></p>
<div id="adding-logos" class="section level3">
<h3 class="hasAnchor">
<a href="#adding-logos" class="anchor"></a>Adding Logos</h3>
<p>If you want to get really fancy, and I know you do, you can include team logos on these graphs. You’ll need to install and load the <code>ggimage()</code> package.</p>
<p>There are probably better/faster ways to do this, but they’re all more complicated. For now, what I’ve done is posted the CSV from collegefootballdata.com’s team page to my github, and we’re just going to rip the logos from there. Not ideal, but it works. You don’t need to change this line at all to get the logos data! We select school and logo because those are the only two things we need for the graphs.</p>
<div class="sourceCode" id="cb26"><html><body><pre class="r"><span class="no">cfblogos</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html">read.csv</a></span>(<span class="st">"https://raw.githubusercontent.com/spfleming/CFB/master/logos.csv"</span>) <span class="kw">%&gt;%</span> <span class="fu">select</span>(<span class="no">school</span>, <span class="no">logo</span>)
<span class="no">chartdata</span> <span class="kw">&lt;-</span> <span class="no">success</span> <span class="kw">%&gt;%</span> <span class="fu">left_join</span>(<span class="no">cfblogos</span>, <span class="kw">by</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"offense_play"</span> <span class="kw">=</span> <span class="st">"school"</span>))</pre></body></html></div>
<p>Now, we have our created success object and the team logos in the chartdata object. We’ll make use of our graph from above, telling the plot that we want to use the logo column of chartdata to identify teams insteald of a regular ol’ marker. This plot takes a minute to run - this is a consequence of pulling the logos from the web each time. It’s not ideal, but again this is the easiest way to make these graphs, so I opted for simplicity.</p>
<p>It might take up to two minutes to load! Don’t freak out! Don’t close R! Just let it load! You’ll see a white screen in your Plots window, but I promise the graph is coming.</p>
<div class="sourceCode" id="cb27"><html><body><pre class="r"><span class="no">chartdata</span> <span class="kw">%&gt;%</span> <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="kw">x</span><span class="kw">=</span><span class="no">rush.rte</span>, <span class="kw">y</span><span class="kw">=</span><span class="no">success.rte</span>)) + <span class="fu">geom_image</span>(<span class="kw">image</span> <span class="kw">=</span> <span class="no">chartdata</span>$<span class="no">logo</span>, <span class="kw">asp</span> <span class="kw">=</span> <span class="fl">16</span>/<span class="fl">9</span>) +
  <span class="fu">geom_vline</span>(<span class="kw">xintercept</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span>(<span class="no">chartdata</span>$<span class="no">rush.rte</span>), <span class="kw">linetype</span> <span class="kw">=</span> <span class="st">"dashed"</span>, <span class="kw">color</span> <span class="kw">=</span> <span class="st">"red"</span>, <span class="kw">alpha</span> <span class="kw">=</span> <span class="fl">0.5</span>) +
  <span class="fu">geom_hline</span>(<span class="kw">yintercept</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span>(<span class="no">chartdata</span>$<span class="no">success.rte</span>), <span class="kw">linetype</span> <span class="kw">=</span> <span class="st">"dashed"</span>, <span class="kw">color</span> <span class="kw">=</span> <span class="st">"red"</span>, <span class="kw">alpha</span> <span class="kw">=</span> <span class="fl">0.5</span>) +
  <span class="fu">labs</span>(<span class="kw">x</span> <span class="kw">=</span> <span class="st">"Early Downs Rush Rate"</span>, <span class="kw">y</span><span class="kw">=</span> <span class="st">"Success Rate"</span>,
       <span class="kw">title</span> <span class="kw">=</span> <span class="st">"2019 FBS Early Downs Rush Rate and Success"</span>) +
  <span class="fu">theme_minimal</span>() +
    <span class="fu">theme</span>(<span class="kw">axis.title</span> <span class="kw">=</span> <span class="fu">element_text</span>(<span class="kw">size</span> <span class="kw">=</span> <span class="fl">12</span>),
    <span class="kw">axis.text</span> <span class="kw">=</span> <span class="fu">element_text</span>(<span class="kw">size</span> <span class="kw">=</span> <span class="fl">10</span>),
    <span class="kw">plot.title</span> <span class="kw">=</span> <span class="fu">element_text</span>(<span class="kw">size</span> <span class="kw">=</span> <span class="fl">20</span>),
    <span class="kw">plot.subtitle</span> <span class="kw">=</span> <span class="fu">element_text</span>(<span class="kw">size</span> <span class="kw">=</span> <span class="fl">14</span>),
        <span class="kw">plot.caption</span> <span class="kw">=</span> <span class="fu">element_text</span>(<span class="kw">size</span> <span class="kw">=</span> <span class="fl">12</span>),
    <span class="kw">panel.grid.minor</span> <span class="kw">=</span> <span class="fu">element_blank</span>())</pre></body></html></div>
<p><img src="intro_files/figure-html/ED_rushrt_successrt-1.png" width="700"></p>
<p>You can save the graphs with ggsave(). That gives you a nice, high-res png file that we can post to Twitter or put in a blog post: <code>ggsave('file.png', height = 7, width = 13, dpi = 300)</code></p>
</div>
<div id="more-visualizations" class="section level3">
<h3 class="hasAnchor">
<a href="#more-visualizations" class="anchor"></a>More Visualizations</h3>
<p>Another useful visualization might be to see the EPA of each of a team’s plays by location on the field. We will filter the dataset to include only our favorite team, and then plot the EPA of each play to examine outliers.</p>
<p>Here’s the 2019 TCU Offense:</p>
<div class="sourceCode" id="cb28"><html><body><pre class="r"><span class="no">tcu</span> <span class="kw">&lt;-</span> <span class="no">plays</span> <span class="kw">%&gt;%</span> <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span>(<span class="no">offense_play</span> <span class="kw">==</span> <span class="st">"TCU"</span>)

<span class="no">tcu</span> <span class="kw">%&gt;%</span>
  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="kw">x</span><span class="kw">=</span><span class="no">yards_to_goal</span>, <span class="kw">y</span><span class="kw">=</span><span class="no">EPA</span>)) +
  <span class="fu">geom_point</span>() +
  <span class="fu">labs</span>(<span class="kw">x</span> <span class="kw">=</span> <span class="st">"Yard Line"</span>,
    <span class="kw">y</span> <span class="kw">=</span> <span class="st">"EPA"</span>,
    <span class="kw">title</span> <span class="kw">=</span> <span class="st">"Expected Points Added by Field Position"</span>,
    <span class="kw">subtitle</span> <span class="kw">=</span> <span class="st">"TCU Offense 2019"</span>) +
  <span class="fu">geom_hline</span>(<span class="kw">yintercept</span> <span class="kw">=</span> <span class="fl">0</span>, <span class="kw">alpha</span> <span class="kw">=</span> <span class="fl">0.5</span>, <span class="kw">col</span> <span class="kw">=</span> <span class="st">"purple"</span>) +
  <span class="fu">theme_minimal</span>() +
    <span class="fu">theme</span>(<span class="kw">axis.title</span> <span class="kw">=</span> <span class="fu">element_text</span>(<span class="kw">size</span> <span class="kw">=</span> <span class="fl">12</span>),
    <span class="kw">axis.text</span> <span class="kw">=</span> <span class="fu">element_text</span>(<span class="kw">size</span> <span class="kw">=</span> <span class="fl">10</span>),
    <span class="kw">plot.title</span> <span class="kw">=</span> <span class="fu">element_text</span>(<span class="kw">size</span> <span class="kw">=</span> <span class="fl">20</span>),
    <span class="kw">plot.subtitle</span> <span class="kw">=</span> <span class="fu">element_text</span>(<span class="kw">size</span> <span class="kw">=</span> <span class="fl">14</span>),
  <span class="kw">plot.caption</span> <span class="kw">=</span> <span class="fu">element_text</span>(<span class="kw">size</span> <span class="kw">=</span> <span class="fl">12</span>),
    <span class="kw">panel.grid.minor</span> <span class="kw">=</span> <span class="fu">element_blank</span>())</pre></body></html></div>
<p><img src="intro_files/figure-html/tcu2019off-1.png" width="700"></p>
<p>I added a couple fun features here: a <em>geom_hline()</em> reference line at zero, to help us better understand the graph, and a subtitle to clarify what was on the graph. Notice that TCU’s EPA was spread almost evenly across the field, but you can see some serious negative ouliers that weighed them down. We could call those outliers into our console to explore them more:</p>
<div class="sourceCode" id="cb29"><html><body><pre class="r"><span class="no">plays</span> <span class="kw">%&gt;%</span> <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span>(<span class="no">offense_play</span> <span class="kw">==</span> <span class="st">"TCU"</span> <span class="kw">&amp;</span> <span class="no">EPA</span> <span class="kw">&lt;</span> -<span class="fl">4</span>) <span class="kw">%&gt;%</span> <span class="fu">select</span>(<span class="no">offense_play</span>, <span class="no">defense_play</span>, <span class="no">play_text</span>, <span class="no">down</span>, <span class="no">distance</span>, <span class="no">yards_to_goal</span>)</pre></body></html></div>
<pre><code>##   offense_play   defense_play
## 1          TCU         Baylor
## 2          TCU Oklahoma State
## 3          TCU          Texas
## 4          TCU  West Virginia
## 5          TCU         Baylor
## 6          TCU Oklahoma State
## 7          TCU Oklahoma State
## 8          TCU            SMU
## 9          TCU  West Virginia
##                                                                                                                                                                 play_text
## 1                                                                                           Max Duggan pass intercepted Grayland Arnold return for no gain to the Bayl 14
## 2                                                                               Max Duggan pass intercepted Kolby Harvell-Peel return for a loss of 4 yards to the OKSt 4
## 3                          Max Duggan pass intercepted Brandon Jones return for a loss of 3 yards to the Texas 24 TEXAS Penalty, Illegal Block (12 Yards) to the Texas 12
## 4                                                                                                 Max Duggan pass intercepted Tykee Smith return for 39 yds to the TCU 14
## 5                                                                                               Max Duggan pass intercepted Terrel Bernard return for 20 yds to the TCU 8
## 6                                                Max Duggan pass complete to John Stephens Jr. for 13 yds John Stephens Jr. fumbled, recovered by OKSt Kolby Harvell-Peel
## 7 Max Duggan pass intercepted Kolby Harvell-Peel return for 5 yds to the OKSt 32 Kolby Harvell-Peel fumbled, forced by Jalen Reagor, recovered by OKSt Kolby Harvell-Peel
## 8                                                                     Max Duggan run for a loss of 4 yards to the TCU 24 Max Duggan fumbled, recovered by SMU Toby Ndukwe
## 9                                                                                                  Max Duggan pass intercepted Sean Mahone return for 3 yds to the TCU 47
##   down distance yards_to_goal
## 1    1       10            24
## 2    2        4            46
## 3    1       10            24
## 4    3        4            57
## 5    1       10            81
## 6    1       10            31
## 7    2       10            78
## 8    2        6            71
## 9    3        7            59</code></pre>
<p>Lastly, let’s explore the <code>gt()</code> pacakge to list the top ten rushing and passing offenses and defenses in the country. We will take our dataset, sort it by the value we want, add a rank variable using mutate(), then apply gt(), simply enough.</p>
<div class="sourceCode" id="cb31"><html><body><pre class="r"><span class="co">#Passing</span>
<span class="no">team.epa</span> <span class="kw">%&gt;%</span> <span class="fu">arrange</span>(<span class="fu">desc</span>(<span class="no">epa.pass.off</span>)) <span class="kw">%&gt;%</span> <span class="fu">mutate</span>(<span class="kw">rank</span> <span class="kw">=</span> <span class="fu">dense_rank</span>(<span class="fu">desc</span>(<span class="no">epa.pass.off</span>))) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span>(<span class="no">rank</span> <span class="kw">&lt;</span> <span class="fl">10</span>) <span class="kw">%&gt;%</span> <span class="fu">gt</span>()</pre></body></html></div>
<style>html {
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Helvetica Neue', 'Fira Sans', 'Droid Sans', Arial, sans-serif;
}

#mkneohagkg .gt_table {
  display: table;
  border-collapse: collapse;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#mkneohagkg .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#mkneohagkg .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#mkneohagkg .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 0;
  padding-bottom: 4px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#mkneohagkg .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#mkneohagkg .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#mkneohagkg .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#mkneohagkg .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#mkneohagkg .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#mkneohagkg .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#mkneohagkg .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#mkneohagkg .gt_group_heading {
  padding: 8px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
}

#mkneohagkg .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#mkneohagkg .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#mkneohagkg .gt_from_md > :first-child {
  margin-top: 0;
}

#mkneohagkg .gt_from_md > :last-child {
  margin-bottom: 0;
}

#mkneohagkg .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#mkneohagkg .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 12px;
}

#mkneohagkg .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#mkneohagkg .gt_first_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
}

#mkneohagkg .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#mkneohagkg .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#mkneohagkg .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#mkneohagkg .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#mkneohagkg .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding: 4px;
}

#mkneohagkg .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#mkneohagkg .gt_sourcenote {
  font-size: 90%;
  padding: 4px;
}

#mkneohagkg .gt_left {
  text-align: left;
}

#mkneohagkg .gt_center {
  text-align: center;
}

#mkneohagkg .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#mkneohagkg .gt_font_normal {
  font-weight: normal;
}

#mkneohagkg .gt_font_bold {
  font-weight: bold;
}

#mkneohagkg .gt_font_italic {
  font-style: italic;
}

#mkneohagkg .gt_super {
  font-size: 65%;
}

#mkneohagkg .gt_footnote_marks {
  font-style: italic;
  font-size: 65%;
}
</style>
<div id="mkneohagkg" style="overflow-x:auto;overflow-y:auto;width:auto;height:auto;"><table class="table gt_table">
<thead class="gt_col_headings"><tr>
<th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1">offense_play</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1">epa.pass.off</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1">epa.rush.off</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1">epa.pass.def</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_center" rowspan="1" colspan="1">rank</th>
    </tr></thead>
<tbody class="gt_table_body">
<tr>
<td class="gt_row gt_left">Air Force</td>
      <td class="gt_row gt_right">0.5734259</td>
      <td class="gt_row gt_right">0.06874982</td>
      <td class="gt_row gt_right">-0.063127043</td>
      <td class="gt_row gt_center">1</td>
    </tr>
<tr>
<td class="gt_row gt_left">Alabama</td>
      <td class="gt_row gt_right">0.5195176</td>
      <td class="gt_row gt_right">0.09293576</td>
      <td class="gt_row gt_right">-0.087450967</td>
      <td class="gt_row gt_center">2</td>
    </tr>
<tr>
<td class="gt_row gt_left">Minnesota</td>
      <td class="gt_row gt_right">0.5032284</td>
      <td class="gt_row gt_right">0.00246669</td>
      <td class="gt_row gt_right">-0.021914496</td>
      <td class="gt_row gt_center">3</td>
    </tr>
<tr>
<td class="gt_row gt_left">LSU</td>
      <td class="gt_row gt_right">0.4510875</td>
      <td class="gt_row gt_right">0.14949404</td>
      <td class="gt_row gt_right">-0.138569200</td>
      <td class="gt_row gt_center">4</td>
    </tr>
<tr>
<td class="gt_row gt_left">Ohio State</td>
      <td class="gt_row gt_right">0.4475847</td>
      <td class="gt_row gt_right">0.16069942</td>
      <td class="gt_row gt_right">-0.176863989</td>
      <td class="gt_row gt_center">5</td>
    </tr>
<tr>
<td class="gt_row gt_left">Oklahoma</td>
      <td class="gt_row gt_right">0.3888950</td>
      <td class="gt_row gt_right">0.17137410</td>
      <td class="gt_row gt_right">-0.044480846</td>
      <td class="gt_row gt_center">6</td>
    </tr>
<tr>
<td class="gt_row gt_left">Utah</td>
      <td class="gt_row gt_right">0.3131092</td>
      <td class="gt_row gt_right">0.02062003</td>
      <td class="gt_row gt_right">-0.163977073</td>
      <td class="gt_row gt_center">7</td>
    </tr>
<tr>
<td class="gt_row gt_left">Memphis</td>
      <td class="gt_row gt_right">0.3068856</td>
      <td class="gt_row gt_right">0.01043691</td>
      <td class="gt_row gt_right">-0.004850261</td>
      <td class="gt_row gt_center">8</td>
    </tr>
<tr>
<td class="gt_row gt_left">Iowa State</td>
      <td class="gt_row gt_right">0.2685644</td>
      <td class="gt_row gt_right">-0.04499110</td>
      <td class="gt_row gt_right">0.002943268</td>
      <td class="gt_row gt_center">9</td>
    </tr>
</tbody>
</table></div>
<p>Now, over in your viewer (bottom right), you should see a sleek table. Ok, well, not so sleek. We will do three things to this table to make it a little more palatable. First, we’ll add a title, second, we’ll switch the order of the variables, and third, we will change the column titles.</p>
<div class="sourceCode" id="cb32"><html><body><pre class="r"><span class="no">team.epa</span> <span class="kw">%&gt;%</span> <span class="fu">arrange</span>(<span class="fu">desc</span>(<span class="no">epa.pass.off</span>)) <span class="kw">%&gt;%</span> <span class="fu">mutate</span>(<span class="kw">rank</span> <span class="kw">=</span> <span class="fu">dense_rank</span>(<span class="fu">desc</span>(<span class="no">epa.pass.off</span>))) <span class="kw">%&gt;%</span>
  <span class="fu">select</span>(<span class="no">rank</span>, <span class="no">offense_play</span>, <span class="no">epa.pass.off</span>) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span>(<span class="no">rank</span> <span class="kw">&lt;</span> <span class="fl">11</span>) <span class="kw">%&gt;%</span> <span class="fu">gt</span>() <span class="kw">%&gt;%</span>
  <span class="fu">tab_header</span>(<span class="kw">title</span> <span class="kw">=</span> <span class="st">"Best Passing Teams"</span>) <span class="kw">%&gt;%</span>
  <span class="fu">cols_label</span>(<span class="kw">rank</span> <span class="kw">=</span> <span class="st">"Rank"</span>, <span class="kw">offense_play</span> <span class="kw">=</span> <span class="st">"Offense"</span>, <span class="kw">epa.pass.off</span> <span class="kw">=</span> <span class="st">"EPA/Attempt"</span>)</pre></body></html></div>
<style>html {
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Helvetica Neue', 'Fira Sans', 'Droid Sans', Arial, sans-serif;
}

#wfogbxuqhg .gt_table {
  display: table;
  border-collapse: collapse;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#wfogbxuqhg .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#wfogbxuqhg .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#wfogbxuqhg .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 0;
  padding-bottom: 4px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#wfogbxuqhg .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#wfogbxuqhg .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#wfogbxuqhg .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#wfogbxuqhg .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#wfogbxuqhg .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#wfogbxuqhg .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#wfogbxuqhg .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#wfogbxuqhg .gt_group_heading {
  padding: 8px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
}

#wfogbxuqhg .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#wfogbxuqhg .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#wfogbxuqhg .gt_from_md > :first-child {
  margin-top: 0;
}

#wfogbxuqhg .gt_from_md > :last-child {
  margin-bottom: 0;
}

#wfogbxuqhg .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#wfogbxuqhg .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 12px;
}

#wfogbxuqhg .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#wfogbxuqhg .gt_first_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
}

#wfogbxuqhg .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#wfogbxuqhg .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#wfogbxuqhg .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#wfogbxuqhg .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#wfogbxuqhg .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding: 4px;
}

#wfogbxuqhg .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#wfogbxuqhg .gt_sourcenote {
  font-size: 90%;
  padding: 4px;
}

#wfogbxuqhg .gt_left {
  text-align: left;
}

#wfogbxuqhg .gt_center {
  text-align: center;
}

#wfogbxuqhg .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#wfogbxuqhg .gt_font_normal {
  font-weight: normal;
}

#wfogbxuqhg .gt_font_bold {
  font-weight: bold;
}

#wfogbxuqhg .gt_font_italic {
  font-style: italic;
}

#wfogbxuqhg .gt_super {
  font-size: 65%;
}

#wfogbxuqhg .gt_footnote_marks {
  font-style: italic;
  font-size: 65%;
}
</style>
<div id="wfogbxuqhg" style="overflow-x:auto;overflow-y:auto;width:auto;height:auto;"><table class="table gt_table">
<thead class="gt_header">
<tr>
<th colspan="3" class="gt_heading gt_title gt_font_normal" style>Best Passing Teams</th>
    </tr>
<tr>
<th colspan="3" class="gt_heading gt_subtitle gt_font_normal gt_bottom_border" style></th>
    </tr>
</thead>
<thead class="gt_col_headings"><tr>
<th class="gt_col_heading gt_columns_bottom_border gt_center" rowspan="1" colspan="1">Rank</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1">Offense</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1">EPA/Attempt</th>
    </tr></thead>
<tbody class="gt_table_body">
<tr>
<td class="gt_row gt_center">1</td>
      <td class="gt_row gt_left">Air Force</td>
      <td class="gt_row gt_right">0.5734259</td>
    </tr>
<tr>
<td class="gt_row gt_center">2</td>
      <td class="gt_row gt_left">Alabama</td>
      <td class="gt_row gt_right">0.5195176</td>
    </tr>
<tr>
<td class="gt_row gt_center">3</td>
      <td class="gt_row gt_left">Minnesota</td>
      <td class="gt_row gt_right">0.5032284</td>
    </tr>
<tr>
<td class="gt_row gt_center">4</td>
      <td class="gt_row gt_left">LSU</td>
      <td class="gt_row gt_right">0.4510875</td>
    </tr>
<tr>
<td class="gt_row gt_center">5</td>
      <td class="gt_row gt_left">Ohio State</td>
      <td class="gt_row gt_right">0.4475847</td>
    </tr>
<tr>
<td class="gt_row gt_center">6</td>
      <td class="gt_row gt_left">Oklahoma</td>
      <td class="gt_row gt_right">0.3888950</td>
    </tr>
<tr>
<td class="gt_row gt_center">7</td>
      <td class="gt_row gt_left">Utah</td>
      <td class="gt_row gt_right">0.3131092</td>
    </tr>
<tr>
<td class="gt_row gt_center">8</td>
      <td class="gt_row gt_left">Memphis</td>
      <td class="gt_row gt_right">0.3068856</td>
    </tr>
<tr>
<td class="gt_row gt_center">9</td>
      <td class="gt_row gt_left">Iowa State</td>
      <td class="gt_row gt_right">0.2685644</td>
    </tr>
<tr>
<td class="gt_row gt_center">10</td>
      <td class="gt_row gt_left">North Carolina</td>
      <td class="gt_row gt_right">0.2518271</td>
    </tr>
</tbody>
</table></div>
<p>This is just a little taste of what you can do in college football data, thanks to collegefootballdata.com and #cfbscrapR.</p>
<p>Let me know of any work you do, resources you can think of, or code you want to share, then I’ll link to it below!</p>
<hr>
<p>Other Great Resources:<br>
* <a href="https://jthomasmock.github.io/nfl_plotting_cookbook/">Tom’s Cookbook for Better Viz</a><br>
* <a href="https://r4ds.had.co.nz/">R For Data Science</a><br>
* <a href="https://www.econometrics-with-r.org/">Introduction to Econometrics with R</a><br>
* GOOGLE: there are a million other outside resources that are so valuable. Don’t pay for anything!<br>
* Books I’d Recommend:<br>
* MATHLETICS by Wayne L. Winson<br>
* Introductory Econometrics: A Modern Approach by Jeffry Wooldridge<br>
* Analyzing Baseball Data with R by Baumer, Albert, and Marchi<br>
* Introduction to Statistical Learning with Applications in R, by James, Witten, Hastie, and Tibshirani</p>
</div>
</div>
<div id="glossary-of-terms-and-functions" class="section level2">
<h2 class="hasAnchor">
<a href="#glossary-of-terms-and-functions" class="anchor"></a>Glossary of terms and functions</h2>
<p>cfbscrapR: the R package that helps you get the college football data. Documentation can be found here:</p>
<div id="functions-in-cfbscrapr" class="section level3">
<h3 class="hasAnchor">
<a href="#functions-in-cfbscrapr" class="anchor"></a>Functions in cfbscrapR</h3>
<ul>
<li>cfb_pbp_data() gets you the play by play for a given week or team. Can loop over this to pull the whole season. If you include ‘drives=TRUE’, you can get the drive data.<br>
</li>
<li>cfb_game_info() gets you the home team, away team, game score, and more info about games.<br>
</li>
<li>plot_pbp_sequencing() and plot_wpa() are both built-in graphics you can play with. See documentation.<br>
tidyverse: the R data science package that helps you wrangle and analyze data.</li>
</ul>
</div>
<div id="functions-we-used-in-the-tidyverse" class="section level3">
<h3 class="hasAnchor">
<a href="#functions-we-used-in-the-tidyverse" class="anchor"></a>Functions we used in the tidyverse</h3>
<ul>
<li>mutate(): creates new variables<br>
</li>
<li>group_by() and summarise(): groups observation and calculates summary statistics<br>
</li>
<li>filter(): keeps observations based on certain conditions (remember to use ==)<br>
</li>
<li>left_join(): takes one dataframe and merges it with another<br>
</li>
<li>head() tail() glimpse() and levels(): all help you inspect the data<br>
</li>
<li>ggplot() and geom_point(): graphing functions that set up a graph and plots scatter plots<br>
(gt: a nice package for getting publication-quality tables<br>
see Tom’s Cookbook to help tweak gt() with all sorts of features.</li>
</ul>
</div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by <a href="https://twitter.com/saiemgilani">Saiem Gilani</a>, <a href="https://twitter.com/msubbaiah1">Meyappan Subbaiah</a>, <a href="https://twitter.com/statsowar">Parker Fleming</a>.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.5.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
